<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="index">
	
	<select id="selectOneRecruitment" resultType="recruitment" parameterType="map">
		select t.*,(select count(*) from favorites where recruitment_no = t.recruitment_no  and member_id = #{memberId}) favoritesCount from recruitment t where recruitment_no = #{recNo}
	</select>
	<select id="selectOneCompany" resultType="company" parameterType="string">
		select * from company where comp_id = #{compId}
	</select>
	
	<select id="selectStatistics" resultMap="Member" parameterType="_int">
		select m.member_id,m.birth,m.gender,a.comp_id,a.cu_resdate from member m join companyApplication a on m.member_id = a.member_id where a.recruitment_no=#{recruitment_no}
	</select>
	<resultMap type="member" id="Member">
		<id column="member_id" property="memberId"/>
		<result column="birth" property="birth"/>
		<result column="gender" property="gender"/>
 		<association javaType="ca" property="ca">
			<result column="comp_id" property="compId"/>
			<result column="cu_resdate" property="cuResdate"/>
		</association>
	</resultMap>
	
	<insert id="insertLocation" parameterType="map">
		insert into area values(#{code},#{name})
	</insert>
	<select id="selectListRecruitment" resultType="recruitment">
		select t.* from(select s.*,(select comp_name from company where comp_id = s.comp_id)compName,(select count(*) from favorites where member_id = #{memberId} and recruitment_no = s.recruitment_no) favoritesCount from recruitment s order by recruitment_no desc )t where rownum between 1 and 6
	</select>
	<select id="selectOneFavorites" parameterType="map" resultType="favorites">
		select * from favorites where member_id = #{memberId} and recruitment_no = #{recNo} and select_no = 0
	</select>
	<insert id="insertFavorites" parameterType="map">
		insert into favorites values(seq_favorites_no.nextval,#{memberId},#{recNo},#{compId},0)	
	</insert>
	<delete id="deleteFavorites" parameterType="map">
		delete from favorites where member_Id = #{memberId} and recruitment_no = #{recNo}
	</delete>
</mapper>
